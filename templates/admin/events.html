{% extends "base.html" %}

{% block title %}Manage Events - Admin - PSRA{% endblock %}

{% block content %}
<section class="section">
    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h2>Manage Events</h2>
            <div style="display: flex; gap: 15px;">
                <a href="{{ url_for('admin.create_event') }}" class="btn">Create Event</a>
                <a href="{{ url_for('admin.admin_dashboard') }}" class="btn btn-outline">Back to Dashboard</a>
            </div>
        </div>

        <!-- Events Table -->
        <div class="card">
            <h3>Events</h3>
            {% if events %}
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                        <thead>
                            <tr style="background-color: var(--bg-secondary);">
                                <th style="padding: 12px; text-align: left; border-bottom: 1px solid var(--border);">Title</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 1px solid var(--border);">Image</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 1px solid var(--border);">Date & Time</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 1px solid var(--border);">Description</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 1px solid var(--border);">Created By</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 1px solid var(--border);">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for event in events %}
                            <tr style="border-bottom: 1px solid var(--border);">
                                <td style="padding: 12px; font-weight: bold;">{{ event.title }}</td>
                                <td style="padding: 12px;">
                                    {% if event.image_url %}
                                    <img src="{{ url_for('static', filename='images/' + event.image_url) }}" alt="Event Image" style="max-width: 80px; max-height: 60px; border-radius: 4px; object-fit: cover;">
                                    {% else %}
                                    <em style="color: var(--text-muted); font-size: 14px;">No image</em>
                                    {% endif %}
                                </td>
                                <td style="padding: 12px;">
                                    {{ event.event_date.strftime('%B %d, %Y') }}
                                    {% if event.event_time %}
                                    <br><small style="color: var(--text-muted);">{{ event.event_time.strftime('%I:%M %p') }}</small>
                                    {% endif %}
                                </td>
                                <td style="padding: 12px;">
                                    <div style="max-width: 300px; word-wrap: break-word;">
                                        {% if event.description %}
                                            {{ event.description[:100] }}{% if event.description|length > 100 %}...{% endif %}
                                        {% else %}
                                            <em style="color: var(--text-muted);">No description</em>
                                        {% endif %}
                                    </div>
                                </td>
                                <td style="padding: 12px;">{{ event.creator.name }}</td>
                                <td style="padding: 12px;">
                                    <a href="{{ url_for('admin.edit_event', event_id=event.id) }}" class="btn" style="padding: 6px 12px; font-size: 14px;">Edit</a>
                                    <form method="POST" action="{{ url_for('admin.delete_event', event_id=event.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this event?')">
                                        <button type="submit" class="btn" style="padding: 6px 12px; font-size: 14px; background-color: #dc3545; margin-left: 5px;">Delete</button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div style="text-align: center; padding: 40px;">
                    <p style="font-size: 18px; color: var(--text-muted); margin-bottom: 20px;">No events created yet.</p>
                    <a href="{{ url_for('admin.create_event') }}" class="btn">Create Your First Event</a>
                </div>
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}
